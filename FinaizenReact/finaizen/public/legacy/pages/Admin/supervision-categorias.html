<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supervisión de IA | Admin Panel</title>

    <!-- ⚡ VERIFICACIÓN INMEDIATA DE AUTENTICACIÓN -->
    <script src="../../js/auth/authCheck.js"></script>

    <link rel="stylesheet" href="../../css/style/base/main.css">
    <link rel="stylesheet" href="../../css/style/components/sidebar.css">
    <link rel="stylesheet" href="../../css/style/pages/supervision_categorias.css">
    <link rel="stylesheet" href="../../css/style/components/modals/modal_correccion_ia.css">
</head>
<body>

<!-- Modal de corrección de IA (incluido como en config_perfiles) -->
<div id="ia-modal-placeholder"></div>

<div class="container">
    <div id="sidebar-container" data-sidebar="admin"></div>
    <main class="main-content">
        
        <div class="kpi-container">
            <div class="kpi-card">
                <h4>Precisión del modelo</h4>
                <p>96.5%</p>
                <span>Últimos 7 días</span>
            </div>
            <div class="kpi-card">
                <h4>Correcciones manuales</h4>
                <p>82</p>
                <span>Últimos 7 días</span>
            </div>
            <div class="kpi-card">
                <h4>Categorías problemáticas</h4>
                <ul class="problem-list">
                    <li>1. Suscripciones</li>
                    <li>2. Transporte</li>
                </ul>
            </div>
        </div>

        <section class="card">
            <h4>Campo de Pruebas de la IA</h4>
            <div class="ai-playground">
                <div class="input-group">
                    <label for="ai-test-input">Ingresa una descripción para probar:</label>
                    <input type="text" id="ai-test-input" placeholder="Ej: 'Pago de la luz'">
                </div>
                <button id="ai-test-btn">Probar</button>
            </div>
            <div id="ai-prediction-result"></div>
        </section>

        <div class="charts-grid">
            <section class="card">
                <h4>Distribución de Confianza</h4>
                <canvas id="confidenceChart"></canvas>
            </section>
            <section class="card">
                <h4>Tendencia de Correcciones</h4>
                <canvas id="correctionsTrendChart"></canvas>
            </section>
        </div>

        <section class="card">
            <div class="filters-bar">
                <select id="confidence-filter">
                    <option value="todos">Todos los niveles</option>
                    <option value="baja">Confianza Baja</option>
                    <option value="media">Confianza Media</option>
                    <option value="alta">Confianza Alta</option>
                </select>
                <input type="text" id="search-input" placeholder="Buscar por descripción...">
            </div>

            <table class="supervision-table">
                <thead>
                    <tr>
                        <th>Descripción del usuario</th>
                        <th>Palabra clave IA</th>
                        <th>Categoría general IA</th>
                        <th>Confianza</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="supervision-tbody"></tbody>
            </table>
        </section>
    </main>
</div>

 <!-- CARGAMOS LOS SCRIPTS EN ORDEN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../js/auth/sessionManager.js"></script>
    <script src="../../js/auth/authGuard.js"></script>
    <!-- 1. El componente del modal (define la clase) -->
    <script src="../../js/components/modals/modal_correccion_ia.js"></script>
    <!-- 2. La lógica de la página (usa la clase del modal) -->
    <script src="../../js/supervision-categorias.js"></script>
    <!-- 3. El orquestador principal (carga el HTML e inicia todo) -->
    <script src="../../js/main.js"></script>

    <script>
        // Proteger esta página - solo admins
        document.addEventListener('DOMContentLoaded', () => {
            AuthGuard.requireAdmin();
        });
    </script>
</body>
</html>

